{% extends 'base.html' %}

{% block title %}Analytics Dashboard{% endblock %}

{% block content %}
<div class="container-fluid" style="padding: 20px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="page-title text-gradient">Analytics & Reports</h1>
            <p class="text-muted">Visual insights into your academic schedule.</p>
        </div>
        <div>
            <span class="badge badge-primary p-2"><i class="fas fa-chart-pie me-2"></i> Live Data</span>
        </div>
    </div>

    <!-- Charts Grid -->
    <div class="row g-4">
        <!-- Faculty Workload -->
        <div class="col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-lg"
                style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;">
                <div class="card-body">
                    <h5 class="card-title text-main mb-4"><i class="fas fa-chalkboard-teacher text-primary me-2"></i>
                        Teacher Workload</h5>
                    <div style="height: 300px;">
                        <canvas id="teacherChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Department Distribution -->
        <div class="col-md-6 mb-4">
            <div class="card h-100 border-0 shadow-lg"
                style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;">
                <div class="card-body">
                    <h5 class="card-title text-main mb-4"><i class="fas fa-building text-success me-2"></i> Department
                        Activity</h5>
                    <div style="height: 300px;">
                        <canvas id="deptChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Room Utilization -->
        <div class="col-12 mb-4">
            <div class="card border-0 shadow-lg"
                style="background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;">
                <div class="card-body">
                    <h5 class="card-title text-main mb-4"><i class="fas fa-door-open text-warning me-2"></i> Classroom
                        Utilization</h5>
                    <div style="height: 300px;">
                        <canvas id="roomChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Data from Flask
    const teacherData = {{ teacher_data | tojson }};
    const deptData = {{ dept_data | tojson }};
    const roomData = {{ room_data | tojson }};

    // Chart Defaults
    Chart.defaults.color = '#94a3b8';
    Chart.defaults.borderColor = 'rgba(255, 255, 255, 0.1)';
    Chart.defaults.font.family = "'Inter', sans-serif";

    // 1. Teacher Workload (Bar)
    new Chart(document.getElementById('teacherChart'), {
        type: 'bar',
        data: {
            labels: Object.keys(teacherData),
            datasets: [{
                label: 'Sessions Assigned',
                data: Object.values(teacherData),
                backgroundColor: 'rgba(99, 102, 241, 0.6)',
                borderColor: '#6366f1',
                borderWidth: 1,
                borderRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)' } } }
        }
    });

    // 2. Dept Distribution (Doughnut)
    new Chart(document.getElementById('deptChart'), {
        type: 'doughnut',
        data: {
            labels: Object.keys(deptData),
            datasets: [{
                data: Object.values(deptData),
                backgroundColor: [
                    'rgba(16, 185, 129, 0.6)',
                    'rgba(59, 130, 246, 0.6)',
                    'rgba(245, 158, 11, 0.6)',
                    'rgba(239, 68, 68, 0.6)'
                ],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { position: 'right' } },
            cutout: '70%'
        }
    });

    // 3. Room Utilization (Line/Result) -> Using Bar for better utilization view
    new Chart(document.getElementById('roomChart'), {
        type: 'bar',
        data: {
            labels: Object.keys(roomData),
            datasets: [{
                label: 'Room Usage Count',
                data: Object.values(roomData),
                backgroundColor: 'rgba(168, 85, 247, 0.5)',
                borderColor: '#a855f7',
                borderWidth: 1,
                borderRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true } }
        }
    });
</script>
{% endblock %}